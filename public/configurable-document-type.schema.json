{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://whitehall-admin.publishing.service.gov.uk/configurable-document-type.schema.json",
  "$defs": {
    "validations": {
      "description": "List of rails validations to apply to properties, mapping to validators in the application. Keys must match available validators.",
      "type": "object",
      "patternProperties": {
        ".*": {
          "type": "object",
          "properties": {
            "attributes": {
              "description": "List of edition fields to validate, with this specific validator.",
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          },
          "additionalProperties": true
        }
      },
      "propertyNames": {
        "enum": [
          "duration",
          "embedded_contacts_exist",
          "length",
          "no_footnotes_allowed",
          "presence",
          "safe_html",
          "valid_internal_path_links"
        ]
      }
    },
    "schema_property": {
      "type": "object",
      "properties": {
        "title": {
          "type": "string",
          "description": "Display name for the content block."
        },
        "description": {
          "type": "string",
          "description": "Description of the content block's purpose. Usually used for hint text."
        },
        "type": {
          "type": "string",
          "description": "Data type for the content block. Should map to an active record type, with the exception of the object type.",
          "enum": [
            "string",
            "integer",
            "date",
            "object"
          ]
        },
        "format": {
          "description": "Format for the content block, e.g., 'govspeak' for rich text, 'image_select' for image picker. Formats represent specific use cases of some of the types. For example, `image_select` blocks are of type `integer`, while `govspeak` blocks are of type `string`. A breakdown of formats and types can be found in the configurable content blocks factory.",
          "type": "string",
          "enum": [
            "default",
            "govspeak",
            "image_select",
            "lead_image_select"
          ]
        },
        "properties": {
          "type": "object",
          "patternProperties": {
            ".*": {
              "$ref": "#/$defs/schema_property"
            }
          }
        },
        "validations": {
          "$ref": "#/$defs/validations"
        }
      },
      "required": [
        "title",
        "type"
      ],
      "additionalProperties": false
    },
    "form_field": {
      "type": "object",
      "properties": {
        "title": {
          "type": "string",
          "description": "Display name for the content block."
        },
        "description": {
          "type": "string",
          "description": "Description of the content block's purpose. Usually used for hint text."
        },
        "block": {
          "type": "string",
          "description": "Identifier for a content block. Maps to a specific block class.",
          "enum": [
            "default_date",
            "default_object",
            "default_string",
            "govspeak",
            "image_select",
            "lead_image_select"
          ]
        },
        "fields": {
          "type": "object",
          "patternProperties": {
            ".*": {
              "$ref": "#/$defs/form_field"
            }
          }
        }
      },
      "required": ["title", "block"],
      "additionalProperties": false
    }
  },
  "title": "Configurable Document Type",
  "description": "Schema for a configurable document type in Whitehall",
  "type": "object",
  "properties": {
    "key": {
      "type": "string",
      "pattern": "^[a-z_]*$",
      "description": "Unique identifier for the document type. This value is stored in the edition's configurable_document_type column."
    },
    "title": {
      "type": "string",
      "description": "Human-readable name for the document type, used in the admin interface."
    },
    "description": {
      "type": "string",
      "description": "A description of the document type's purpose and intended use."
    },
    "schema": {
      "type": "object",
      "description": "Defines the content structure for the document type. Each property represents a content block.",
      "properties": {
        "properties": {
          "type": "object",
          "description": "Fields/content blocks for the document, each with its own schema.",
          "patternProperties": {
            ".*": {
              "$ref": "#/$defs/schema_property"
            }
          }
        },
        "attributes": {
          "type": "object",
          "description": "Alternative to `properties`, defining content blocks with minimal schema information.",
          "patternProperties": {
            ".*": {
              "type": "object",
              "properties": {
                "type": {
                  "type": "string",
                  "description": "Data type for the content block. Should map to an active record type, with the exception of the object type.",
                  "enum": [
                    "string",
                    "integer",
                    "date",
                    "object"
                  ]
                }
              },
              "required": ["type"],
              "additionalProperties": false
            }
          }
        },
        "validations": {
          "$ref": "#/$defs/validations"
        },
        "headings_from": {
          "type": "array",
          "description": "Array of content block names, from which to extract headings, used to generate the table of contents for the rendered document. Headings are sent to publishing API as part of the `details` hash.",
          "items": {
            "type": "string"
          }
        }
      },
      "additionalProperties": false
    },
    "forms": {
      "type": "object",
      "description": "Defines the content structure for the document type. Each property represents a content block.",
      "properties": {
        "documents": {
          "type": "object",
          "properties": {
            "fields": {
              "type": "object",
              "description": "Fields/content blocks for the document, each with its own schema.",
              "patternProperties": {
                ".*": {
                  "$ref": "#/$defs/form_field"
                }
              }
            }
          }
        }
      },
      "additionalProperties": false
    },
    "presenters": {
      "type": "object",
      "description": "Defines how content blocks map to publishing API presenters and formats.",
      "properties": {
        "publishing_api": {
          "type": "object",
          "description": "Mapping of content blocks to their respective publishing API presenter formats.",
          "patternProperties": {
            ".*": {
              "type": "string",
              "description": "The format to use for the content block when presenting to the Publishing API.",
              "enum": [
                "govspeak",
                "rfc3339_date",
                "image",
                "lead_image",
                "string"
              ]
            }
          },
          "propertyNames": {
            "type": "string",
            "description": "Attribute to be included in the presenter payload. Must match an existing attribute defined in the schema."
          }
        }
      },
      "additionalProperties": false,
      "required": ["publishing_api"]
    },
    "associations": {
      "type": "array",
      "description": "List of associations to other content (e.g., organisations, topical events), allowing the document to be linked to other entities.",
      "items": {
        "type": "object",
        "properties": {
          "key": {
            "type": "string",
            "description": "Type of association. Determines what kind of related content can be linked.",
            "enum": [
              "ministerial_role_appointments",
              "organisations",
              "worldwide_organisations",
              "topical_events",
              "world_locations"
            ]
          }
        },
        "required": [
          "key"
        ]
      }
    },
    "settings": {
      "type": "object",
      "description": "A list of configurations to enable certain edition behaviours.",
      "properties": {
        "edit_screens": {
          "type": "object",
          "description": "A list of rendered screens (tabs) for the content type. Controls which content blocks appear on which editing screens (document, images).",
          "properties": {
            "document": {
              "type": "array",
              "description": "A list of content blocks to display on the main document editing screen. The keys must match the blocks listed as properties.",
              "items": {
                "type": "string"
              }
            },
            "images": {
              "type": "array",
              "description": "A list of content blocks to display on the images editing screen. The keys must match the blocks listed as properties.",
              "items": {
                "type": "string"
              }
            }
          },
          "additionalProperties": false
        },
        "base_path_prefix": {
          "type": "string",
          "description": "URL prefix for where documents of this type are published. E.g. /government/history."
        },
        "configurable_document_group": {
          "type": "string",
          "description": "Optional grouping for document types. Used for categorisation in the admin interface, including search filters. Typically matches the `publishing_api_schema_name`. For example, both `news_story` and `government_response` types would have the group `news_article`."
        },
        "publishing_api_schema_name": {
          "type": "string",
          "description": "Name of the schema in the Publishing API for this document type. Different types might share the same schema name. For example, `news_story` and `government_response` types both use the `news_article` schema."
        },
        "publishing_api_document_type": {
          "type": "string",
          "description": "Document type name in the Publishing API."
        },
        "rendering_app": {
          "type": "string",
          "description": "The frontend application responsible for rendering this document type."
        },
        "images_enabled": {
          "type": "boolean",
          "description": "Whether users can upload images for this document type. When enabled, it renders the Images tab."
        },
        "send_change_history": {
          "type": "boolean",
          "description": "Whether to send change history to the Publishing API. The change history will allow users to see major change updates to the document. Most editionable types should have this enabled."
        },
        "organisations": {
          "type": ["array", "null"],
          "description": "Array of organisation content IDs allowed to use this type, or null to allow all organisations.",
          "items": {
            "type": "string"
          }
        },
        "backdating_enabled": {
          "type": "boolean",
          "description": "Whether backdating is allowed for this document type. This is required for documents representing past printed papers or documents from other digital sources outside Whitehall."
        },
        "history_mode_enabled": {
          "type": "boolean",
          "description": "Whether history mode is enabled for this document type. This controls whether the document can be marked as political."
        },
        "file_attachments_enabled": {
          "type": "boolean",
          "description": "Whether file attachments are allowed for this document type. When enabled, it renders the Attachments tab."
        },
        "translations_enabled": {
          "type": "boolean",
          "description": "Whether translations are supported for this document type."
        }
      },
      "required": [
        "base_path_prefix",
        "publishing_api_schema_name",
        "publishing_api_document_type",
        "rendering_app",
        "images_enabled",
        "send_change_history",
        "organisations",
        "backdating_enabled",
        "history_mode_enabled",
        "file_attachments_enabled",
        "translations_enabled"
      ]
    }
  },
  "required": [
    "key",
    "schema",
    "associations",
    "settings"
  ]
}
