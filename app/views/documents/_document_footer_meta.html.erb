<%
  policies ||= nil
  topics ||= []
  history = document.change_history
%>
<div class="document-footer-meta">
  <div class="history">
    <dl class="primary-metadata">
      <dt><%= t('document.footer_meta.published') %>:</dt>
      <% if document.state != 'published' %>
        <dd>Preview</dd>
      <% else %>
        <dd><%= absolute_date(history.last.public_timestamp) %></dd>

        <% if history.length > 1 %>
          <dt><%= t('document.footer_meta.updated') %>:</dt>
          <dd><%= absolute_date(history.first.public_timestamp) %></dd>
        <% end %>
      <% end %>
    </dl>
    <% if history.length > 1 %>
      <div class="footer-change-notes js-toggle-footer-change-notes">
        <p class="toggle">+ <%= t('document.footer_meta.full_page_history') %></p>
        <div class="overlay js-hidden">
          <dl>
            <% history.each do |change| %>
              <dt><%= absolute_time(change.public_timestamp, class: 'published-at') %></dt>
              <dd><%= change.note %></dd>
            <% end %>
          </dl>
        </div>
      </div>
    <% end %>
  </div>
  <div class="links">
    <dl class="primary-metadata">
      <% if document.organisations.any?  %>
        <dt><%= t('document.headings.organisations', count: document.organisations.length) %>:</dt>
        <dd>
          <%= render  partial: 'organisations/organisations_name_list',
                      locals: { organisations: document.sorted_organisations,
                                lead_organisations: document.lead_organisations } %>
        </dd>
      <% end %>
      <%= render  partial: 'documents/metadata_links',
                  locals: { document: document, 
                    topics: topics, 
                    policies: policies } %>
    </dl>
  </div>
</div>

