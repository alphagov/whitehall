<% page_title @world_location.name, "UK and the world" %>
<% page_class "world-locations-show" %>
<% atom_discovery_link_tag world_location_url(@world_location, format: :atom), "Latest activity" %>
<%= content_tag_for(:div, @world_location) do %>

  <div class="block">
    <div class="inner-block">
      <header class="page-header world-locations <% if @featured_editions.any? %>with_featured<% end %>">
        <hgroup>
          <h2 class="type"><%= @world_location.display_type %></h2>
          <h1 class="name">UK and <%= @world_location.name %></h1>
        </hgroup>
      </header>
    </div>
  </div>

  <div class="block news-block">
    <div class="inner-block">
      <section class="featured-news items-<%= @featured_editions.length %>" id="featured-documents">
        <% if @featured_editions.any? %>
          <%= render partial: 'shared/featured_news',
                     collection: @featured_editions,
                     as: :edition,
                     locals: { show_meta: true,
                               extra_class: "secondary" } %>
        <% end %>

        <%= render partial: 'shared/recently_updated',
                  locals: { recently_updated: @recently_updated,
                            atom_url: world_location_url(@world_location, format: :atom),
                            govdelivery_url: '',
                            extra_class: 'panel'} %>
      </section>
    </div>
  </div>

  <div class="block our-mission">
    <div class="inner-block">
      <section class="article-section">
        <h1 class="keyline-header">Our mission</h1>
        <p>
          <span class="description"><%= format_with_html_line_breaks(@world_location.description) %></span>
        </p>
      </section>
    </div>
  </div>

  <div class="block">
    <div class="inner-block">
      <% if @international_priorities.any? %>
        <section id="international-priorities">
          <h1 class="keyline-header">Priorities</h1>
          <% @international_priorities.each do |priority| %>
            <%= content_tag_for(:article, priority) do %>
              <h2><%= link_to priority.title, public_document_path(priority) %></h2>
              <p><%= priority.summary %></p>
            <% end %>
          <% end %>
        </section>
      <% end %>
    </div>
  </div>

  <% if @policies.any? %>
    <div class="block-5">
      <div class="inner-block">
        <section id="policies" class="heading-block">
          <h1 class="label"><%= link_to 'Related policies', policies_filter_path(@world_location) %></h1>
          <div class="content">
            <%= render partial: "policies/list_description", locals: {policies: @policies} %>
            <p class="see-all">
              <%= link_to 'See all of our policies', policies_filter_path(@world_location) %>
            </p>
          </div>
        </section>
      </div>
    </div>
  <% end %>
  <% if (@non_statistics_publications + @announcements + @statistics_publications).any? %>
    <% document_block_count = 0 %>
    <div class="block documents-grid">
      <div class="inner-block">
        <h1 class="block-title">Documents</h1>
        <% if @announcements.any? %>
          <section id="announcements" class="document-block documents-<%= document_block_count+=1 %>">
            <h1>Our announcements</h1>
            <div class="content">
              <%= render partial: "announcements/list_description", locals: {announcements: @announcements} %>
              <p class="see-all">
                <%= link_to "See all of our announcements", announcements_filter_path(@world_location) %>
              </p>
            </div>
          </section>
        <% end %>
        <% if @non_statistics_publications.any? %>
          <section id="publications" class="document-block documents-<%= document_block_count+=1 %>">
            <h1>Our publications</h1>
            <div class="content">
              <%= render partial: "publications/list_description", locals: {publications: @non_statistics_publications} %>
              <p class="see-all">
                <%= link_to 'See all of our publications', publications_filter_path(@world_location) %>
              </p>
            </div>
          </section>
        <% end %>
        <% if @statistics_publications.any? %>
          <section id="statistics-publications" class="document-block documents-<%= document_block_count+=1 %>">
            <h1>Our statistics</h1>
            <div class="content">
              <%= render partial: "publications/list_description", locals: {publications: @statistics_publications} %>
              <p class="see-all">
                <%= link_to 'See all of our statistics', publications_filter_path(@world_location, publication_filter_option: 'statistics') %>
              </p>
            </div>
          </section>
        <% end %>
      </div>
    </div>
  <% end %>

  <div class="block contacts">
    <div class="inner-block">
      <% if @world_location.embassy_address.present? %>
        <section class="vcard info embassy_contact_details">
          <h1 class="fn org name label keyline-header">UK contacts in <%= @world_location.name %></h1>
          <div class="adr">
            <p class="embassy_address street-address"><%= safe_join(@world_location.embassy_address.split("\n"), "<br/>".html_safe) %></p>
          </div>
          <p class="embassy_telephone tel">
            <span class="type">Telephone</span>:
            <span class="value"><%= @world_location.embassy_telephone %></span>
          </p>
          <p class="embassy_email email"><%= mail_to @world_location.embassy_email %></p>
        </section>
      <% end %>
    </div>
  </div>
<% end %>
