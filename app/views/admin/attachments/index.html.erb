<% page_title "Attachments for: #{@attachable.title}" %>
<% page_class "attachments index" %>

<div class="span8">
  <section>
    <h1>Attachments for <%= @attachable.type.underscore.humanize.downcase %></h1>

    <%= attachable_editing_tabs(@attachable) do %>
      <ul class="actions">
        <li>
          <%= link_to 'Upload new attachment', new_admin_edition_attachment_path(@attachable) %>
        </li>
        <li>
          <%= link_to 'Upload from ZIP file&hellip;'.html_safe, new_admin_edition_bulk_upload_path(@attachable) %>
        </li>
      </ul>

      <% if @edition.attachments.any? %>

        <% if @edition.can_order_attachments? %>
          <p class="alert alert-info">
            To change the order of your attachments, drag them up or down and then click "Save attachment order" at
            the bottom of the page.
          </p>
        <% end %>

        <%= form_tag order_admin_edition_attachments_path(@edition), method: :put do %>
          <ol class="existing-attachments<%= ' js-sortable' if @edition.can_order_attachments? %>">
            <% @edition.attachments.each do |attachment| %>
              <li class="well">
                <span class="title"><%= attachment.title %></span>
                <span class="file">File: <%= link_to attachment.filename, attachment.url %></span>
                <%= attachment_metadata_tag(attachment) %>

                <% if @edition.can_order_attachments? %>
                  <%= label_tag "ordering-#{attachment.id}", "Order:" %>
                  <%= text_field_tag "ordering[#{attachment.id}]", attachment.ordering, id: "ordering-#{attachment.id}", class: "ordering" %>
                <% end %>

                <ul class="actions">
                  <li>
                    <%= link_to 'Edit', edit_admin_edition_attachment_path(@edition, attachment) %>
                  </li>
                  <li>
                    <%= link_to 'Delete', admin_edition_attachment_path(@edition, attachment), method: 'delete', confirm: 'Are you sure you want to delete this attachment?' %>
                  </li>
                </ul>
              </li>
            <% end %>
          </ol>

          <% if @edition.can_order_attachments? %>
            <%= submit_tag 'Save attachment order', class: 'btn btn-primary' %>
          <% end %>

        <% end %>
      <% end %>
    <% end %>
  </section>
</div>
